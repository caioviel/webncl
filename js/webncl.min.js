var Debugger={WARN_INVALID_ATTR:100,WARN_INVALID_TAG:101,WARN_INVALID_HEAD_STRUCTURE:102,WARN_INVALID_REGION_DIMENSIONS:103,WARN_DUPLICATED_ZINDEX:104,WARN_NOT_IMPLEMENTED_YET:105,ERR_MISSING_ATTR:201,ERR_MISSING_ATTR_ONEOF:202,ERR_MISSING_ATTR_DEP:203,ERR_TOO_MANY_ATTRS:204,ERR_MISSING_TAG:205,ERR_MISSING_TAG_ONEOF:206,ERR_TOO_MANY_TAGS:207,ERR_TOO_MANY_TAGS_ONEOF:208,ERR_INVALID_ATTR_VALUE:209,ERR_INVALID_ID_REFERENCE:210,ERR_DUPLICATED_ID:211,ERR_INCOMPATIBLE_FILE_EXT:212,ERR_INVALID_URI:213,ERR_DUPLICATED_ATTR:214,
ERR_DUPLICATED_ALIAS:215,ERR_INVALID_CONTEXT_REFERENCE:216,MESSAGES:{100:"Atributo inv\u00e1lido",101:"Tag inv\u00e1lida",102:"Estrutura do cabe\u00e7alho inv\u00e1lida",103:"Dimens\u00f5es de regi\u00e3o inv\u00e1lidas",104:"zIndex duplicado",105:"Recurso n\u00e3o implementado ainda",201:"Atributo obrigat\u00f3rio faltando",202:"Atributo obrigat\u00f3rio faltando (um desses)",203:"Atributo dependente faltando",204:"Excesso de atributos repetidos",205:"Tag obrigat\u00f3ria faltando",206:"Tag obrigat\u00f3ria faltando (uma dessas)",
207:"Excesso de tags repetidas",208:"Excesso de tags (apenas uma permitida)",209:"Valor de atributo inv\u00e1lido",210:"Refer\u00eancia a ID inv\u00e1lido",211:"ID duplicado",212:"Extens\u00e3o de arquivo incompat\u00edvel com o MIMETYPE",213:"URI inv\u00e1lida",214:"Atributo duplicado",215:"Alias duplicado",216:"Objeto referenciado em outro contexto"},abort:!1,error:function(a,b,c){console.error("["+a+"] "+this.MESSAGES[a]+"\n"+b+": "+c.join(","));this.abort=!0},warning:function(a,b,c){console.warn("["+
a+"] "+this.MESSAGES[a]+"\n"+b+": "+c.join(","))}};function WebNclPlayer(a,b){this.presentation={TIME_LIMIT:1E3,playerId:++WebNclPlayer.playerCount,playerDiv:b,getDivId:function(a,b){return"ncl"+this.playerId+(b||"")+"_"+(this.parser.referenceMap.instReuse[a]||a)},path:/[\/]*.+\//g.exec(a)[0]};this.presentation.bodyDiv="body"+this.presentation.playerId;this.presentation.settingsDiv="settings"+this.presentation.playerId;this.presentation.contextsDiv="contexts"+this.presentation.playerId;this.presentation.keyEvents={};$.ajax({type:"GET",url:a,dataType:"xml",
success:$.proxy(function(a){this.execute(a)},this)})}
WebNclPlayer.prototype.execute=function(a){var b=new Date;this.presentation.parser=new Parser;this.presentation.ncl=this.presentation.parser.parse(a);console.log("Loading time: "+(new Date-b)+"ms");this.presentation.focusManager=new FocusManager(this.presentation);this.presentation.systemSettings=new SystemSettings(this.presentation);for(rb in this.presentation.ncl.head.regionBase)for(i in this.presentation.ncl.head.regionBase[rb].region)a={left:0,top:0,width:parseInt($("#"+this.presentation.playerDiv).css("width").split("px")[0]),
height:parseInt($("#"+this.presentation.playerDiv).css("height").split("px")[0])},this.fixRegionBounds(this.presentation.ncl.head.regionBase[rb].region[i],a);$("#"+this.presentation.playerDiv).attr("tabindex",this.presentation.playerId);$("#"+this.presentation.playerDiv).append("<div id='"+this.presentation.settingsDiv+"'></div>");$("#"+this.presentation.playerDiv).append("<div id='"+this.presentation.contextsDiv+"'></div>");(new ContextPlayer(this.presentation.ncl.body,this.presentation)).start()};
WebNclPlayer.prototype.fixRegionBounds=function(a,b){var c={left:a.left||null,right:a.right||null,top:a.top||null,bottom:a.bottom||null,width:a.width||null,height:a.height||null},d={left:0,top:0,width:0,height:0};for(i in c)null!=c[i]&&1==c[i].split("%").length&&(c[i]=parseInt(c[i].split("px")[0]));var e,f;e=["left","right","width"];for(i in e)null!=c[e[i]]&&isNaN(c[e[i]])&&(f=c[e[i]].split("%"),0<f.length&&(c[e[i]]=parseInt(b.width*parseFloat(f[0])/100)));e=["top","bottom","height"];for(i in e)null!=
c[e[i]]&&isNaN(c[e[i]])&&(f=c[e[i]].split("%"),1<f.length&&(c[e[i]]=parseInt(b.height*parseInt(f[0])/100)));null!=c.left?null!=c.right?null==c.width&&(c.width=b.width-c.left-c.right):null==c.width&&(c.width=b.width):null!=c.width?c.left=null!=c.right?b.width-c.right-c.width:0:null!=c.right?(c.left=0,c.width=b.width-c.right):(c.left=0,c.width=b.width);null!=c.top?null!=c.bottom?null==c.height&&(c.height=b.height-c.top-c.bottom):null==c.height&&(c.height=b.height):null!=c.height?c.top=null!=c.bottom?
b.height-c.bottom-c.height:0:null!=c.bottom?(c.top=0,c.height=b.height-c.bottom):(c.top=0,c.height=b.height);d.left=b.left+c.left;d.top=b.top+c.top;d.width=c.width;d.height=c.height;a.left=d.left+"px";a.top=d.top+"px";a.width=d.width+"px";a.height=d.height+"px";a.right=null;a.bottom=null;for(i in a.region)this.fixRegionBounds(a.region[i],d)};WebNclPlayer.prototype.triggerEvent=function(a,b,c){$("#"+this.presentation.getDivId(b)).trigger(a,[c])};WebNclPlayer.playerCount=0;function FocusManager(a){this.presentation=a;var a=a.ncl.head.descriptorBase.descriptor,b=[],c;for(c in a){var d=a[c];d.focusIndex&&(b.push(d.focusIndex),this.descriptors[d.focusIndex]={self:d,mediaArray:[]})}this.bindKeyDown()}
FocusManager.prototype.addMedia=function(a,b){if(a in this.descriptors){var c=this.descriptors[a];-1==c.mediaArray.indexOf(b)&&(c.mediaArray.push(b),this.bindMouseEvents(a,b));a in this.focusIndexArray||this.focusIndexArray.push(a);this.currentFocusIndex?this.currentFocusIndex==a&&this.setMediaFocus(b):this.setCurrentFocus(a)}};
FocusManager.prototype.removeMedia=function(a,b){if(a in this.descriptors){var c=this.descriptors[a],d=c.mediaArray.indexOf(b);-1!=d&&(c.mediaArray.splice(d,1),this.unbindMouseEvents(b));a==this.currentFocusIndex&&0==c.mediaArray.length&&(this.focusIndexArray.splice(this.focusIndexArray.indexOf(a),1),0==this.focusIndexArray.length?this.setCurrentFocus(void 0):(this.focusIndexArray.sort(this.sortFunction),this.setCurrentFocus(this.focusIndexArray[0])))}};
FocusManager.prototype.setCurrentFocus=function(a){if(void 0==a)this.currentFocusIndex=a;else if(-1!=this.focusIndexArray.indexOf(a)){if(this.currentFocusIndex){var b=this.descriptors[this.currentFocusIndex],c;for(c in b.mediaArray){var d=currentDescriptor.mediaArray[c];this.removeMediaFocus(d)}}currentDescriptor=this.descriptors[a];for(c in currentDescriptor.mediaArray)d=currentDescriptor.mediaArray[c],this.setMediaFocus(d);this.currentFocusIndex=a;return!0}return!1};
FocusManager.prototype.getCurrentFocus=function(){return this.currentFocusIndex};FocusManager.prototype.setMediaFocus=function(a){$(a).trigger("focus")};FocusManager.prototype.removeMediaFocus=function(a){$(a).trigger("blur")};FocusManager.prototype.bindKeyDown=function(){$("#"+this.presentation.playerDiv).on("keydown",$.proxy(function(a){-1!=Keys.allCodes.indexOf(a.which)&&(a.preventDefault(),this.keyEvent(a.which))},this))};FocusManager.prototype.unbindKeyDown=function(){$(window).off("keydown")};
FocusManager.prototype.keyEvent=function(a){this.triggerKeyEvents(a);if(this.currentFocusIndex)switch(currentDescriptor=this.descriptors[this.currentFocusIndex],a){case Keys.CURSOR_UP:currentDescriptor.self.moveUp&&this.setCurrentFocus(currentDescriptor.self.moveUp.focusIndex);break;case Keys.CURSOR_DOWN:currentDescriptor.self.moveDown&&this.setCurrentFocus(currentDescriptor.self.moveDown.focusIndex);break;case Keys.CURSOR_LEFT:currentDescriptor.self.moveLeft&&this.setCurrentFocus(currentDescriptor.self.moveLeft.focusIndex);
break;case Keys.CURSOR_RIGHT:currentDescriptor.self.moveRight&&this.setCurrentFocus(currentDescriptor.self.moveRight.focusIndex);break;case Keys.ENTER:for(var b in currentDescriptor.mediaArray)currentMedia=currentDescriptor.mediaArray[b],$(currentMedia).trigger("selection.onSelection")}};
FocusManager.prototype.bindMouseEvents=function(a,b){$(b).css("cursor","pointer");$(b).on("click",$.proxy(function(a){1==a.which&&this.keyEvent(Keys.ENTER)},this));$(b).on("mouseover",{focusIndex:a},$.proxy(function(a){this.setCurrentFocus(a.data.focusIndex)},this))};FocusManager.prototype.unbindMouseEvents=function(a){$(a).off("click");$(a).off("mouseover");$(a).css("cursor","default")};
FocusManager.prototype.enableKeys=function(a){a&&a in this.presentation.keyEvents&&(this.presentation.keyEvents[a]=!0)};FocusManager.prototype.disableKeys=function(a){a&&a in this.presentation.keyEvents&&(this.presentation.keyEvents[a]=!1)};FocusManager.prototype.triggerKeyEvents=function(a){var b=[],c;for(c in this.presentation.keyEvents)this.presentation.keyEvents[c]&&b.push(c);for(var d in b){c=b[d];var e=$.Event("selection.onSelection");e.which=a;$(c).trigger(e)}};
FocusManager.prototype.currentFocusIndex=void 0;FocusManager.prototype.descriptors={};FocusManager.prototype.focusIndexArray=[];FocusManager.sortFunction=function(a,b){a=(""+a).toLowerCase();b=(""+b).toLowerCase();return a>b?1:a<b?-1:0};Keys={allCodes:[13,37,38,39,40,81,87,69,82,96,97,98,99,100,101,102,103,104,105,90,88,67,86,66,78,65,83,68],CURSOR_UP:38,CURSOR_DOWN:40,CURSOR_LEFT:37,CURSOR_RIGHT:39,ENTER:13,RED:81,GREEN:87,YELLOW:69,BLUE:82,KEY_0:96,KEY_1:97,KEY_2:98,KEY_3:99,KEY_4:100,KEY_5:101,KEY_6:102,KEY_7:103,KEY_8:104,KEY_9:105,BACK:90,EXIT:88,PLAY:67,STOP:86,PAUSE:66,RECORD:78,POWER:65,REWIND:83,EJECT:68};function Listener(a,b,c,d,e){this.listenerType=a;this.actionOperator=b;this.actionMap=c;this.flagMap=d;this.assessmentStatements=e;this.last=new Date;this.triggerBuffer=void 0;this.actionNamesArray=[];for(actionName in c)this.actionNamesArray.push(actionName)}
Listener.prototype.notifyEvent=function(a){switch(this.listenerType){case Listener.listenerType.SIMPLE:this.__verifyAssessmentStatements()&&this.__executeActions();break;case Listener.listenerType.AND:if((new Date).valueOf()-this.last.valueOf()>presentation.TIME_LIMIT){for(var b in this.flagMap)this.flagMap[b].flag=!1;this.flagMap[a].flag=!0;this.last=new Date}else{a=this.flagMap[a].flag=!0;for(b in this.flagMap)if(!this.flagMap[b].flag){a=!1;break}if(a){for(b in this.flagMap)this.flagMap[b].flag=
!1;this.last=0;this.__verifyAssessmentStatements()&&this.__executeActions()}}break;case NclPlayer.listenerType.OR:(new Date).valueOf()-this.last.valueOf()>presentation.TIME_LIMIT&&(this.last=new Date,this.__executeActions())}};
Listener.prototype.__verifyAssessmentStatements=function(){for(var a in this.assessmentStatements){var b=this.assessmentStatements[a],c=$(b.bindComponent).data("property")[b.bindInterface];switch(b.operator){case "eq":if(c!=b.value)return!1;break;case "ne":if(c==b.value)return!1;break;case "lt":if(!(c<b.value))return!1;break;case "lte":if(!(c<=b.value))return!1;break;case "gt":if(!(c>b.value))return!1;break;case "gte":if(!(c>=b.value))return!1}}return!0};
Listener.prototype.__executeActions=function(){"seq"==this.actionOperator?this.__executeActionsSeq([0]):this.__executeActionsPar()};Listener.prototype.__executeActionsSeq=function(a){a=a[0];a<this.actionNamesArray.length&&this.__callTriggers([this.actionNamesArray[a],a])};Listener.prototype.__executeActionsPar=function(){for(var a in this.actionMap)this.__callTriggers([a,-1])};
Listener.prototype.__callTriggers=function(a){var b=a[0],a=a[1];"seq"==this.actionMap[b].qualifier?this.__callTriggersSeq([b,a,0]):this.__callTriggersPar([b,a])};
Listener.prototype.__callTriggersSeq=function(a){var b=a[0],c=a[1],a=a[2],d=this.actionMap[b].binds,e=d[a];0<=c?0==a&&0==c?a==d.length-1?this.triggerBuffer.push([e.bindComponent,b,[e.bindInterface,$.proxy(this.__executeActionsSeq,this),[c+1],e.value]]):this.triggerBuffer.push([e.bindComponent,b,[e.bindInterface,$.proxy(this.__callTriggersSeq,this),[b,c,a+1],e.value]]):a<d.length-1?$(e.bindComponent).trigger(b,[e.bindInterface,$.proxy(this.__callTriggersSeq,this),[b,c,a+1],e.value]):$(e.bindComponent).trigger(b,
[e.bindInterface,$.proxy(this.__executeActionsSeq,this),[c+1],e.value]):0==a?a==d.length-1?this.triggerBuffer.push([e.bindComponent,b,[e.bindInterface,null,null,e.value]]):this.triggerBuffer.push([e.bindComponent,b,[e.bindInterface,$.proxy(this.__callTriggersSeq,this),[b,c,a+1],e.value]]):a<d.length-1?$(e.bindComponent).trigger(b,[e.bindInterface,$.proxy(this.__callTriggersSeq,this),[b,c,a+1],e.value]):$(e.bindComponent).trigger(b,[e.bindInterface,null,null,e.value])};
Listener.prototype.__callTriggersPar=function(a){var b=a[0],a=a[1],c=this.actionMap[b],d,e;for(e in c.binds)d=c.binds[e],e==c.binds.length-1&&0<=a?0==a?this.triggerBuffer.push([d.bindComponent,b,[d.bindInterface,$.proxy(this.__executeActionsSeq,this),[a+1],d.value]]):$(d.bindComponent).trigger(b,[d.bindInterface,$.proxy(this.__executeActionsSeq,this),[a+1],d.value]):0>=a?this.triggerBuffer.push([d.bindComponent,b,[d.bindInterface,null,null,d.value]]):$(d.bindComponent).trigger(b,[d.bindInterface,
null,null,d.value])};Listener.listenerType={SIMPLE:0,AND:1,OR:2};function SystemSettings(a){this.settings={"default.focusBorderColor":"blue","default.selBorderColor":"yellow","default.focusBorderWidth":2,"default.focusBorderTransparency":0,"service.currentKeyMaster":""};this.setMap={"service.currentFocus":$.proxy(a.focusManager.setCurrentFocus,a.focusManager)};this.getMap={"service.currentFocus":$.proxy(a.focusManager.getCurrentFocus,a.focusManager)}}
SystemSettings.prototype.setPropertyValue=function(a,b){if(a in this.settings)this.settings[a]=b;else if(a in this.setMap)this.setMap[a](b);else return!1;return!0};SystemSettings.prototype.getPropertyValue=function(a){return a in this.settings?this.settings[a]:a in this.setMap?this.getMap[a]():""};function Parser(){this.referenceMap={map:[],instReuse:[],addSource:function(a,b,c){this.map[a[b]]||(this.map[a[b]]={sources:[]});this.map[a[b]].sources.push({obj:a,attr:b,type:c})},addTarget:function(a,b,c,d){var e=!1;if(this.map[b])if(this.map[b].target)if("property"==d||"connectorParam"==d){if(this.map[b].target.parents[c])return!1}else return!1;else e=!0;else this.map[b]={sources:[]},e=!0;e&&(this.map[b].target={obj:a,type:d,parents:[]});return this.map[b].target.parents[c]=!0},pop:function(a){return this.map[a]?
this.map[a].target:!1},createReferences:function(){for(id in this.map)for(i in this.map[id].sources){var a=this.map[id].sources[i];this.map[id].target&&this.map[id].target.obj&&-1!=$.inArray(this.map[id].target.type,a.type)?"refer"==a.attr?"media"==a.obj._type&&(a.obj.descriptor=this.map[id].target.obj.descriptor,a.obj.src=this.map[id].target.obj.src,a.obj.type=this.map[id].target.obj.type,"new"!=a.obj.instance&&(this.instReuse[a.obj.id]=id)):a.obj[a.attr]=this.map[id].target.obj:Debugger.error(Debugger.ERR_INVALID_ID_REFERENCE,
a.type,[a.attr,a.obj[a.attr],a.type])}}};this.uniqueTable=[]}Parser.prototype.parse=function(a){this.ncl=this.createNode(a);this.referenceMap.createReferences();return this.ncl};
Parser.prototype.createNode=function(a,b,c,d){b=b||"ncl";a=$(a).find("ncl"==b?"ncl":"> "+b);if(0==a.length)return!1;var e=[],f=Parser.nclStructureMap[b].attrs;f.required||(f.required=[]);f.optional||(f.optional=[]);f.oneOf||(f.oneOf=[]);var g=[].concat(f.required,f.optional,f.oneOf),f=Parser.nclStructureMap[b].content;f.optional||(f.optional=[]);f.one||(f.one=[]);f.plus||(f.plus=[]);f.plusOneOf||(f.plusOneOf=[]);f.star||(f.star=[]);f.custom||(f.custom=[]);var o=[].concat(f.optional,f.one,f.plus,f.plusOneOf,
f.star,f.custom),h=this;$(a).each(function(){var a={_type:b};for(i in g)a[g[i]]=$(this).attr(g[i]);var f=d+">"+b;a.id&&(f+="#"+a.id);h.parseAttributes(this,a);h.parseContent(this,a);for(i in o)a[o[i]]=h.createNode(this,o[i],a,f);e.push(a);if("ncl"==b)h.parseNCL(a,b,c,d);else h["parse"+b[0].toUpperCase()+b.slice(1,b.length)](a,b,c,d)});return-1==$.inArray(b,Parser.isNotArray)?e:e[0]};
Parser.prototype.parseAttributes=function(a,b){for(var c=$(a).get(0).attributes,d=b._type,e=Parser.nclStructureMap[d].attrs,f=[],g=0;g<c.length;g++)f.push(c.item(g).name);for(g in e.reference_source)for(attr in e.reference_source[g][0])$(a).attr(e.reference_source[g][0][attr])&&this.referenceMap.addSource(b,e.reference_source[g][0][attr],e.reference_source[g][1]);for(attr in e.reference_target)$(a).attr(e.reference_target[attr])&&(c="focusIndex"==e.reference_target[attr]?"focusIndex":d,this.referenceMap.addTarget(b,
$(a).attr(e.reference_target[attr]),$(a).parent().attr("id"),c)||Debugger.error(Debugger.ERR_DUPLICATED_ID,d,[e.reference_target[attr],$(a).attr(e.reference_target[attr]),$(a).parent().attr("id")]));for(attr in e.required)if(c=f.indexOf(e.required[attr]),-1==c)Debugger.error(Debugger.ERR_MISSING_ATTR,d,[e.required[attr]]);else for(f[c]=0;c=-1!=f.indexOf(e.required[attr]);)Debugger.error(Debugger.ERR_TOO_MANY_ATTRS,d,[e.required[attr]]),f[c]=0;for(attr in e.optional)if(c=f.indexOf(e.optional[attr]),
-1!=c)for(f[c]=0;c=-1!=f.indexOf(e.required[attr]);)Debugger.error(Debugger.ERR_TOO_MANY_ATTRS,d,[e.required[attr]]),f[c]=0;g=0==e.oneOf.length;for(attr in e.oneOf)if(c=f.indexOf(e.oneOf[attr]),-1!=c){g=!0;for(f[c]=0;c=-1!=f.indexOf(e.oneOf[attr]);)Debugger.error(Debugger.ERR_TOO_MANY_ATTRS,d,[e.oneOf[attr]]),f[c]=0}g||Debugger.error(Debugger.ERR_MISSING_ATTR_ONEOF,d,e.oneOf);for(attr in f)0!=f[attr]&&Debugger.warning(Debugger.WARN_INVALID_ATTR,d,[f[attr]])};
Parser.prototype.parseContent=function(a,b){var c=b._type,d=Parser.nclStructureMap[c].content,e=[],f=[],f=f.concat(d.one,d.optional,d.plus,d.plusOneOf,d.star,d.custom),g;for(g in f)e[f[g]]=0;$(a).find("> *").each(function(){var a=$(this).get(0).tagName;e[a]?e[a]++:e[a]=1});for(g in d.optional)1<e[d.optional[g]]&&Debugger.error(Debugger.ERR_TOO_MANY_TAGS,c,[d.optional[g]]),e[d.optional[g]]=0;for(g in d.one)1<e[d.one[g]]&&Debugger.error(Debugger.ERR_TOO_MANY_TAGS,c,[d.one[g]]),0==e[d.one[g]]&&Debugger.error(Debugger.ERR_MISSING_TAG,
c,[d.one[g]]),e[d.one[g]]=0;for(g in d.plus)0==e[d.plus[g]]&&Debugger.error(Debugger.ERR_MISSING_TAG,c,[d.plus[g]]),e[d.plus[g]]=0;f=0==d.plusOneOf.length;for(g in d.plusOneOf)0<e[d.plusOneOf[g]]&&(f=!0),e[d.plusOneOf[g]]=0;f||Debugger.error(Debugger.ERR_MISSING_TAG_ONEOF,c,d.plusOneOf);for(g in d.star)e[d.star[g]]=0;if(0<d.custom.length){d.validate(e,errors=[]);for(err in errors)Debugger.error(errors[err].code,c,errors[err].params);for(g in d.custom)e[d.custom[g]]=0}for(g in e)0<e[g]&&Debugger.warning(Debugger.WARN_INVALID_TAG,
c,[g])};Parser.eventType={onBegin:"presentation",onEnd:"presentation",onAbort:"presentation",onPause:"presentation",onResume:"presentation",onSelection:"selection",onBeginAttribution:"attribution",onEndAttribution:"attribution"};
Parser.mediaTypes={htm:"text/htm",html:"text/html",txt:"text/plain",css:"text/css",xml:"text/xml",bmp:"image",png:"image",gif:"image",jpg:"image",jpeg:"image",wav:"audio",mp3:"audio",mp2:"audio",mp4:"video",mpg4:"video",mpeg:"video",mpg:"video",webm:"video",lua:"application/x-ginga-NCLua","class":"application/x-ginga-NCLet",jar:"application/x-ginga-NCLet"};
Parser.colorValues={white:"255,255,255",black:"0,0,0",silver:"192,192,192",gray:"128,128,128",red:"255,0,0",maroon:"128,0,0",fuchsia:"255,0,255",purple:"128,0,128",lime:"0,255,0",green:"0,128,0",yellow:"255,255,0",olive:"128,128,0",blue:"0,0,255",navy:"0,0,128",aqua:"0,255,255",teal:"0,128,128"};Parser.isNotArray="ncl head body importedDocumentBase ruleBase transitionBase descriptorBase connectorBase defaultDescriptor valueAssessment defaultComponent".split(" ");
Parser.nclStructureMap={area:{attrs:{reference_target:["id"],required:["id"],optional:"coords begin end text position first last label".split(" ")},content:{}},assessmentStatement:{attrs:{required:["comparator"]},content:{custom:["attributeAssessment","valueAssessment"],validate:function(a,b){var c=a.attributeAssessment,d=a.valueAssessment;0==c&&b.push({code:Debugger.ERR_MISSING_TAG,params:["attributeAssessment"]});2>c&&0==d&&b.push({code:Debugger.ERR_MISSING_TAG_ONEOF,params:["attributeAssessment",
"valueAssessment"]});2==c&&0<d&&b.push({code:Debugger.ERR_TOO_MANY_TAGS_ONEOF,params:["attributeAssessment","valueAssessment"]});2<c&&b.push({code:Debugger.ERR_TOO_MANY_TAGS,params:["attributeAssessment"]});1<d&&b.push({code:Debugger.ERR_TOO_MANY_TAGS,params:["valueAssessment"]})}}},attributeAssessment:{attrs:{required:["role","eventType","attributeType"],optional:["key","offset"]},content:{}},bind:{attrs:{reference_source:[[["descriptor"],["descriptor"]],[["component"],["context","media"]],[["nodeInterface"],
["port","area","property"]]],required:["role","component"],optional:["interface","descriptor"]},content:{star:["bindParam"]}},bindParam:{attrs:{required:["name","value"]},content:{}},bindRule:{attrs:{reference_source:[[["constituent"],["media"]],[["rule"],["rule"]]],required:["constituent","rule"]},content:{}},body:{attrs:{reference_target:["id"],optional:["id"]},content:{star:"port property media context switch link".split(" ")}},causalConnector:{attrs:{reference_target:["id"],required:["id"]},content:{star:["connectorParam"],
custom:["simpleCondition","compoundCondition","simpleAction","compoundAction"],validate:function(a,b){0==a.simpleCondition&&0==a.compoundCondition?b.push({code:Debugger.ERR_MISSING_TAG_ONEOF,params:["simpleCondition","compoundCondition"]}):0<a.simpleCondition&&0<a.compoundCondition?b.push({code:Debugger.ERR_TOO_MANY_TAGS_ONEOF,params:["simpleCondition","compoundCondition"]}):1<a.simpleCondition?b.push({code:Debugger.ERR_TOO_MANY_TAGS,params:["simpleCondition"]}):1<a.compoundCondition&&b.push({code:Debugger.ERR_TOO_MANY_TAGS,
params:["compoundCondition"]});0==a.simpleAction&&0==a.compoundAction?b.push({code:Debugger.ERR_MISSING_TAG_ONEOF,params:["simpleAction","compoundAction"]}):0<a.simpleAction&&0<a.compoundAction?b.push({code:Debugger.ERR_TOO_MANY_TAGS_ONEOF,params:["simpleAction","compoundAction"]}):1<a.simpleAction?b.push({code:Debugger.ERR_TOO_MANY_TAGS,params:["simpleAction"]}):1<a.compoundAction&&b.push({code:Debugger.ERR_TOO_MANY_TAGS,params:["compoundAction"]})}}},compositeRule:{attrs:{required:["id","operator"]},
content:{plusOneOf:["rule","compositeRule"]}},compoundAction:{attrs:{required:["operator"],optional:["delay"]},content:{plusOneOf:["simpleAction","compoundAction"]}},compoundCondition:{attrs:{required:["operator"],optional:["delay"]},content:{plusOneOf:["simpleCondition","compoundCondition"],star:["assessmentStatement","compoundStatement"]}},compoundStatement:{attrs:{required:["operator"],optional:["isNegated"]},content:{plusOneOf:["assessmentStatement","compoundStatement"]}},connectorBase:{attrs:{optional:["id"]},
content:{star:["importBase","causalConnector"]}},connectorParam:{attrs:{reference_target:["name"],ref_group:!0,required:["name"],optional:["type"]},content:{}},context:{attrs:{reference_source:[[["refer"],["body","context"]]],reference_target:["id"],required:["id"],optional:["refer"]},content:{star:"port property media context switch link".split(" ")}},defaultComponent:{attrs:{reference_source:[[["component"],["context","media"]]],required:["component"]},content:{}},defaultDescriptor:{attrs:{reference_source:[[["descriptor"],
["descriptor"]]],required:["descriptor"]},content:{}},descriptor:{attrs:{reference_source:[[["region"],["region"]],[["moveLeft","moveRight","moveUp","moveDown"],["focusIndex"]],[["transIn","transOut"],["transition"]]],reference_target:["id","focusIndex"],required:["id"],optional:"player explicitDur region freeze moveLeft moveRight moveUp moveDown focusIndex focusBorderColor focusBorderWidth focusBorderTransparency focusSrc focusSelSrc selBorderColor transIn transOut".split(" ")},content:{star:["descriptorParam"]}},
descriptorBase:{attrs:{optional:["id"]},content:{plusOneOf:["importBase","descriptor","descriptorSwitch"]}},descriptorParam:{attrs:{required:["name","value"]},content:{}},descriptorSwitch:{attrs:{required:["id"]},content:{optional:["defaultDescriptor"],star:["bindRule","descriptor"]}},head:{attrs:{},content:{optional:["importedDocumentBase","ruleBase","transitionBase","descriptorBase","connectorBase"],star:["regionBase","meta","metadata"]}},importBase:{attrs:{reference_source:[[["region"],["region"]]],
required:["alias","documentURI"],optional:["region"]},content:{}},importedDocumentBase:{attrs:{optional:["id"]},content:{plus:["importNCL"]}},importNCL:{attrs:{required:["alias","documentURI"]},content:{}},link:{attrs:{reference_source:[[["xconnector"],["causalConnector"]]],required:["xconnector"],optional:["id"]},content:{plus:["bind"],star:["linkParam"]}},linkParam:{attrs:{required:["name","value"]},content:{}},mapping:{attrs:{reference_source:[[["component"],["context","media"]],[["nodeInterface"],
["port","area","property"]]],required:["component"],optional:["interface"]},content:{}},media:{attrs:{reference_source:[[["refer"],["media"]],[["descriptor"],["descriptor"]]],reference_target:["id"],required:["id"],optional:["instance","descriptor"],oneOf:["type","src","refer"]},content:{star:["area","property"]}},meta:{attrs:{required:["name","content"]},content:{}},metadata:{attrs:{},content:{}},ncl:{attrs:{optional:["id","title","xmlns"]},content:{optional:["head","body"]}},port:{attrs:{reference_source:[[["component"],
["context","media"]],[["nodeInterface"],["port","area","property"]]],reference_target:["id"],required:["id","component"],optional:["interface"]},content:{}},property:{attrs:{reference_target:["name"],ref_group:!0,required:["name"],optional:["value"]},content:{}},region:{attrs:{reference_target:["id"],required:["id"],optional:"title left right top bottom height width zIndex".split(" ")},content:{star:["region"]}},regionBase:{attrs:{optional:["id","device"]},content:{plusOneOf:["importBase","region"]}},
rule:{attrs:{reference_source:[[["var"],["property"]]],required:["id","var","comparator","value"]},content:{}},ruleBase:{attrs:{optional:["id"]},content:{plusOneOf:["importBase","rule","compositeRule"]}},simpleAction:{attrs:{required:["role"],optional:"delay eventType actionType value min max qualifier repeat repeatDelay duration by".split(" ")},content:{}},simpleCondition:{attrs:{required:["role"],optional:"delay eventType key transition min max qualifier".split(" ")},content:{}},"switch":{attrs:{reference_source:[[["refer"],
["switch"]]],reference_target:["id"],required:["id"],optional:["refer"]},content:{optional:["defaultComponent"]}},switchPort:{attrs:{required:["id"]},content:{plus:["mapping"]}},transition:{attrs:{ref_multiple:!0,reference_target:["id"],required:["id","type"],optional:"subtype dur startProgress endProgress direction fadeColor horRepeat vertRepeat borderWidth borderColor".split(" ")},content:{}},transitionBase:{attrs:{optional:["id"]},content:{plusOneOf:["importBase","transition"]}},valueAssessment:{attrs:{required:["value"]},
content:{}}};ContextPlayer.prototype=new Player;
function ContextPlayer(a,b){this.synchronizedPlayers=[];this.loadingPlayers=0;this.handlers={};this.node=a;this.media=[];this.context=[];this.port=[];this.pausedMediaList=[];this.pausedContextList=[];this.isCreated=!1;this.htmlPlayer="";this.isPlaying=!1;this.isStopped=!0;this.presentation=b;this.htmlPlayer=a.id?b.getDivId(a.id):b.bodyDiv;$("#"+b.contextsDiv).append("<div class='context' id='"+this.htmlPlayer+"'></div>");this.htmlPlayer="#"+this.htmlPlayer;$(this.htmlPlayer).data("player",this);$(this.htmlPlayer).data("property",
[]);this.bindEvents()}ContextPlayer.prototype.syncPlayer=function(a){this.synchronizedPlayers.push(a.popcornPlayer);this.loadingPlayers++};ContextPlayer.prototype.notify=function(a){if(a)if(2<=a.popcornPlayer.readyState())this.notify();else $(a.htmlPlayer).one("canplaythrough",$.proxy(function(){this.notify()},this));else if(0==--this.loadingPlayers)for(i in this.synchronizedPlayers)this.synchronizedPlayers[i].play()};
ContextPlayer.prototype.create=function(){if(!this.isCreated){this.isCreated=!0;for(i in this.node.media)this.media[this.node.media[i].id]=new MediaPlayer(this.node.media[i],this);for(i in this.node.context)this.context[this.node.context[i].id]=new ContextPlayer(this.node.context[i],this.presentation);for(i in this.node.port)this.port[this.node.port[i].id]=this.node.port[i];for(i in this.node.property)this.setProperty(this.node.property[i].name,this.node.property[i].value);this.bindLinks()}return this};
ContextPlayer.prototype.start=function(a){if(this.isStopped){this.isCreated||this.create();this.isPlaying=!0;this.isStopped=!1;if(a)this.startPort(this.port[a]);else for(i in this.port)this.startPort(this.port[i]);$(this.htmlPlayer).trigger("presentation.onBegin",[a])}};
ContextPlayer.prototype.startPort=function(a){switch(a.component._type){case "context":this.context[a.component.id]?a.nodeInterface?(this.context[a.component.id].create(),this.context[a.component.id].port[a.nodeInterface.id]?this.context[a.component.id].start(a.nodeInterface.id):Debugger.error(Debugger.ERR_INVALID_CONTEXT_REFERENCE,"port",[a.id,"interface",a.nodeInterface.id])):this.context[a.component.id].start():Debugger.error(Debugger.ERR_INVALID_CONTEXT_REFERENCE,"port",[a.id,"component",a.component.id]);
break;case "media":(nodeInterface=a["interface"])?this.media[a.component.id].start(nodeInterface):this.media[a.component.id].start()}};ContextPlayer.prototype.stop=function(a){if(!this.isStopped){this.isPlaying=!1;this.isStopped=!0;for(i in this.context)this.context[i].stop();for(i in this.media)this.media[i].stop();this.pausedMediaList=[];this.pausedContextList=[];$(this.htmlPlayer).trigger("presentation.onEnd",[a])}};
ContextPlayer.prototype.pause=function(a){if(this.isPlaying){this.isStopped=this.isPlaying=!1;for(i in this.context)this.context[i].isPlaying&&(this.pausedContextList.push(i),this.context[i].pause());for(i in this.media)this.media[i].isPlaying&&(this.pausedMediaList.push(i),this.media[i].pause());$(this.htmlPlayer).trigger("presentation.onPause",[a])}};
ContextPlayer.prototype.resume=function(a){if(!this.isPlaying&&!this.isStopped){this.isPlaying=!0;this.isStopped=!1;for(i in this.pausedContextList)this.context[this.pausedContextList[i]].resume();for(i in this.pausedMediaList)this.media[this.pausedMediaList[i]].resume();this.pausedContextList=[];this.pausedMediaList=[];$(this.htmlPlayer).trigger("presentation.onResume",[a])}};
ContextPlayer.prototype.abort=function(a){if(!this.isStopped){this.isPlaying=!1;this.isStopped=!0;for(i in this.context)this.context[i].abort();for(i in this.media)this.media[i].abort();this.pausedMediaList=[];this.pausedContextList=[];$(this.htmlPlayer).trigger("presentation.onAbort",[a])}};ContextPlayer.isVariable=function(a){return"$"==a.substring(0,1)};ContextPlayer.createLocalParamMap=function(a){var b={};for(i in a)currentBindParam=a[i],b["$"+currentBindParam.name]=currentBindParam.value;return b};
ContextPlayer.executeTriggerArray=function(a){for(var b;void 0!=(b=a.shift());)$(b[0]).trigger(b[1],b[2])};
ContextPlayer.prototype.bindLinks=function(){var a=this.node.port,b=this.node.link,c=this.handlers,d;for(d in a){var e=a[d],f=e["interface"]||void 0;if("media"==e.component._type&&f)console.warn("Eventos de atribuicao para propriedades referenciadas por portas nao foi implementado");else{var f="#"+this.presentation.getDivId(e.component.id),g=e.id,o;for(o in Parser.eventType){var h=Parser.eventType[o];if("attribution"!=h){var m=[h,o].join(".");$(f).on(m,{contextElement:this.htmlPlayer,interfaceId:g,
eventName:m},function(a){var b=$.Event(a.data.eventName);b.which=a.which;$(a.data.contextElement).trigger(b,[a.data.interfaceId])})}}}}for(d in b){var a=b[d],k=a.xconnector,f={},g={},m=0,r="par",j=k.simpleCondition,s={},t={},l=[];if(k.connectorParam)for(d in k.connectorParam)currentConnectorParam=k.connectorParam[d],s["$"+currentConnectorParam.name]="";if(k.compoundCondition)for(d in j=k.compoundCondition[0].simpleCondition,1<j.length&&(m=Listener.listenerType[k.compoundCondition[0].operator.toUpperCase()]),
k.compoundCondition[0].assessmentStatement)for(o in h=k.compoundCondition[0].assessmentStatement[d],h.attributeAssessment)e=h.attributeAssessment[o],"attribution"==e.eventType&&(!e.attributeType||"nodeProperty"==e.attributeType?t[e.role]={bindComponent:"",bindInterface:"",operator:h.comparator,value:h.valueAssessment.value,variable:ContextPlayer.isVariable(h.valueAssessment.value)}:console.warn("Eventos de tipos diferentes de attribution nao foram implementados para elementos do tipo AttributeAssessment"));
for(o in t)l.push(t[o]);for(d in j){var h=j[d],e=!1,p="",q=!1;"onSelection"==h.role&&h.key&&(ContextPlayer.isVariable(h.key)&&(e=!0),p=h.key,q=!0);g[h.role]={bindComponent:"",bindInterface:null,eventType:Parser.eventType[h.role],flag:!1,keyUseVariable:e,keyDefaultValue:p,useKey:q}}h=k.simpleAction;k.compoundAction&&(r=k.compoundAction[0].operator.toLowerCase(),h=k.compoundAction[0].simpleAction);for(d in h)j=h[d],"set"==j.role?(k=!1,e="",j.value&&(ContextPlayer.isVariable(j.value)&&(k=!0),e=j.value),
f[j.role]={binds:[],qualifier:h[d].qualifier,actionUseVariable:k,actionDefaultValue:e}):f[j.role]={binds:[],qualifier:h[d].qualifier};r=new Listener(m,r,f,g,l);if(a.linkParam)for(d in a.linkParam)currentLinkParam=a.linkParam[d],s["$"+currentLinkParam.name]=currentLinkParam.value;for(d in a.bind)if(l=a.bind[d],p=l.component.id,m="#"+this.presentation.getDivId(p),k=l["interface"],f[l.role])h=null,j=f[l.role],"set"==l.role&&(j.actionUseVariable?(n=ContextPlayer.createLocalParamMap(l.bindParam),h=n[j.actionDefaultValue]?
n[j.actionDefaultValue]:s[j.actionDefaultValue]):h=j.actionDefaultValue),j.binds.push({bindComponent:m,bindInterface:k,value:h});else if(g[l.role]){e=g[l.role];e.bindComponent=m;e.bindInterface=k;j=m;h=Parser.eventType[l.role];m=l.role;h=[h,m].join(".");p=[p,h].join(".");q=h+".triggerArray";if(e.useKey){var n=ContextPlayer.createLocalParamMap(l.bindParam);e.keyDefaultValue=n[e.keyDefaultValue]||s[e.keyDefaultValue];n=e.keyDefaultValue;$.isNumeric(n)&&(n="KEY_"+n);n in Keys&&(e.keyDefaultValue=Keys[n]);
n="undefined";e=j;if("context"==l.component._type&&k){for(d in l.component.port)if(e=l.component.port[d],portId=l.component.port[d].id,portId==k){n=e;break}e="#"+this.presentation.getDivId(n.component.id)}this.presentation.keyEvents[e]=!1}c[p]||(c[p]=!0,$(j).data(q)||$(j).data(q,[]),$(j).data(h)||$(j).data(h,[]),$(j).on(h,{componentDivId:j,bindName:h,eventName:m,triggerArrayName:q},function(a,b){var c=$(a.data.componentDivId).data(a.data.bindName),d;for(d in c){var e=c[d],f=e.flagMap[a.data.eventName];
b==f.bindInterface&&(!a.which&&!f.usekey?e.notifyEvent(a.data.eventName):a.which&&f.keyDefaultValue==a.which&&e.notifyEvent(a.data.eventName))}ContextPlayer.executeTriggerArray($(a.data.componentDivId).data(a.data.triggerArrayName))}));r.triggerBuffer=$(j).data(q);$(j).data(h).push(r)}else currentAssessment=t[l.role],currentAssessment.bindComponent=m,currentAssessment.bindInterface=k,currentAssessment.variable&&(n=ContextPlayer.createLocalParamMap(l.bindParam),currentAssessment.value=n[currentAssessment.value]?
n[currentAssessment.value]:s[currentAssessment.value])}};MediaPlayer.prototype=new Player;function MediaPlayer(a,b){this.htmlPlayerBkg=this.htmlPlayer=this.type=this.region="";this.popcornPlayer={};this.area=[];this.transIn=[];this.transOut=[];this.isPlaying=!1;this.isVisible=this.isStopped=!0;this.isFocused=!1;this.explicitDur=void 0;this.opacity=1;this.node=a;this.presentation=b.presentation;this.parentContext=b;this.create(a)}
MediaPlayer.prototype.checkType=function(a){var b=this.type.split("/"),c;for(c in a){var d=a[c].split("/");if(d[0]==b[0]&&(!d[1]||b[1]&&d[1]==b[1]))return!0}return!1};
MediaPlayer.prototype.create=function(a){a.descriptor&&(this.transIn=a.descriptor.transIn,this.transOut=a.descriptor.transOut,a.descriptor.explicitDur&&(vector=a.descriptor.explicitDur.split("s"),this.explicitDur=vector[0]));for(i in a.area)if(this.area[a.area[i].id]=a.area[i],a.area[i].begin&&(this.area[a.area[i].id].beginTime=parseInt(a.area[i].begin.split("s")[0])),a.area[i].end)this.area[a.area[i].id].endTime=parseInt(a.area[i].end.split("s")[0]),this.area[a.area[i].id].started=!1;if(a.type)this.type=
a.type;else{var b=a.src.split(".");this.type=Parser.mediaTypes[b[b.length-1]]}this.htmlPlayer="#"+this.presentation.getDivId(a.id);this.htmlPlayerBkg="#"+this.presentation.getDivId(a.id,"bkg");this.region=this.checkType(["application"])?"#"+this.presentation.settingsDiv:"#"+this.presentation.playerDiv;if(!(a.refer&&"new"!=a.instance)){$(this.region).append("<div class='playerBkg' id='"+this.presentation.getDivId(a.id,"bkg")+"'></div>");switch(this.type.split("/")[0]){case "video":$(this.htmlPlayerBkg).append("<video class='player' poster='images/loading.gif' id='"+
this.presentation.getDivId(a.id)+"'></video>");break;case "audio":$(this.htmlPlayerBkg).append("<audio class='player' id='"+this.presentation.getDivId(a.id)+"'></audio>");break;case "image":$(this.htmlPlayerBkg).append("<img class='player' id='"+this.presentation.getDivId(a.id)+"'></img>");break;case "application":switch(this.type){case "application/x-ginga-settings":$(this.htmlPlayerBkg).append("<div class='player' id='"+this.presentation.getDivId(a.id)+"'></div>");break;case "application/x-ginga-NCLua":Debugger.warning(Debugger.WARN_NOT_IMPLEMENTED_YET,
"media",[this.type]);break;case "application/x-ginga-NCLet":Debugger.warning(Debugger.WARN_NOT_IMPLEMENTED_YET,"media",[this.type]);break;case "application/x-ginga-time":Debugger.warning(Debugger.WARN_NOT_IMPLEMENTED_YET,"media",[this.type])}break;case "text":switch(this.type){case "text/plain":case "text/html":$(this.htmlPlayerBkg).append("<div class='player' id='"+this.presentation.getDivId(a.id)+"'></div>");break;case "text/css":Debugger.warning(Debugger.WARN_NOT_IMPLEMENTED_YET,"media",[this.type]);
break;case "text/xml":Debugger.warning(Debugger.WARN_NOT_IMPLEMENTED_YET,"media",[this.type])}}$(this.htmlPlayerBkg).css("display","none");this.load(a.src);if(this.checkType(["video","audio"])){do this.popcornPlayer=new Popcorn(this.htmlPlayer);while(!this.popcornPlayer)}else if(this.checkType(["image","text"])){do Popcorn.player("baseplayer"),this.popcornPlayer=new Popcorn.baseplayer(this.htmlPlayer);while(!this.popcornPlayer)}if(this.checkType(["video","audio","image","text"]))for(i in $(this.htmlPlayer).on("ended",
$.proxy(function(){this.stop()},this)),this.area)this.area[i].end&&eval("this.popcornPlayer.exec(this.area[i].endTime,$.proxy(function() {if (this.area['"+i+"'].started) {this.area['"+i+"'].started = false;$(this.htmlPlayer).trigger('stop',[this.area['"+i+"'].id]);} else {$(this.htmlPlayer).trigger('presentation.onEnd',[this.area['"+i+"'].id]); }},this));"),this.area[i].begin&&eval("this.popcornPlayer.exec(this.area[i].beginTime,$.proxy(function() {$(this.htmlPlayer).trigger('presentation.onBegin',[this.area['"+
i+"'].id]);},this));");$(this.htmlPlayer).data("property",[]);if(a.descriptor)for(i in a.descriptor.region&&(this.setProperty("zIndex",a.descriptor.region.zIndex),this.setProperty("width",a.descriptor.region.width),this.setProperty("height",a.descriptor.region.height),this.setProperty("bottom",a.descriptor.region.bottom),this.setProperty("top",a.descriptor.region.top),this.setProperty("right",a.descriptor.region.right),this.setProperty("left",a.descriptor.region.left),this.setProperty("title",a.descriptor.region.title)),
a.descriptor.descriptorParam)this.setProperty(a.descriptor.descriptorParam[i].name,a.descriptor.descriptorParam[i].value);for(i in a.property)this.setProperty(a.property[i].name,a.property[i].value);this.explicitDur&&this.popcornPlayer.exec(this.explicitDur,$.proxy(function(){this.stop()},this));this.bindEvents();$(this.htmlPlayer).data("player",this)}};
MediaPlayer.prototype.load=function(a){$(this.htmlPlayer).empty();a=this.presentation.path+a;switch(this.type.split("/")[0]){case "video":$(this.htmlPlayer).append("<source src='"+a+"'></source>");break;case "audio":$(this.htmlPlayer).append("<source src='"+a+"'></source>");break;case "image":$(this.htmlPlayer).attr("src",a);break;case "text":this.checkType(["text/plain","text/html"])&&$.ajax({type:"GET",url:a,dataType:"text",success:$.proxy(function(a){$(this.htmlPlayer).append(a)},this)})}};
MediaPlayer.prototype.focus=function(){if(!this.isFocused&&(this.isFocused=!0,this.node.descriptor)){var a=parseInt(this.node.descriptor.focusBorderWidth||this.presentation.systemSettings.getPropertyValue("default.focusBorderWidth"));if(0<a){var b=this.node.descriptor.focusBorderColor||this.presentation.systemSettings.getPropertyValue("default.focusBorderColor"),c=1-parseInt(this.node.descriptor.focusBorderTransparency||0),b=a+"px solid rgba("+Parser.colorValues[b]+","+c+")";$(this.htmlPlayerBkg).css("left",
"-="+a);$(this.htmlPlayerBkg).css("top","-="+a);$(this.htmlPlayerBkg).css("border",b)}else 0>a&&Debugger.warning(Debugger.WARN_NOT_IMPLEMENTED_YET,"border",[a]);this.node.descriptor.focusSrc&&this.load(this.node.descriptor.focusSrc)}};
MediaPlayer.prototype.blur=function(){this.isFocused=!1;$(this.htmlPlayerBkg).css("left",$(this.htmlPlayer).data("property").left);$(this.htmlPlayerBkg).css("top",$(this.htmlPlayer).data("property").top);$(this.htmlPlayerBkg).css("width",$(this.htmlPlayer).data("property").width);$(this.htmlPlayerBkg).css("height",$(this.htmlPlayer).data("property").height);$(this.htmlPlayerBkg).css("border","none");this.node.descriptor.focusSrc&&this.load(this.node.src)};
MediaPlayer.prototype.selection=function(){if(this.node.descriptor){var a;a=this.node.descriptor.selBorderColor||this.presentation.systemSettings.getPropertyValue("default.selBorderColor");$(this.htmlPlayer).css("border-color",a);a="var p=$('"+this.htmlPlayer+"').data('player'); if (p.isFocused) p.focus(); else p.blur();";this.node.descriptor.focusSelSrc&&(this.load(this.node.descriptor.focusSelSrc),this.node.descriptor.focusSrc||(a+="$('"+this.htmlPlayer+"').data('player').load('"+this.node.src+
"');"));setTimeout(a,200)}};
MediaPlayer.prototype.applyTransition=function(a,b){var c=a.dur?1E3*parseInt(a.dur.split("s")[0]):1E3,d={},e={},f="";switch(a.type){case "fade":a.subtype=a.subtype||"crossfade";f=this.htmlPlayer;d.opacity=a.startProgress||0;e.opacity=a.endProgress||1;if("fadeToColor"==a.subtype||"fadeFromColor"==a.subtype)$(this.htmlPlayerBkg).css("background-color",a.fadeColor||"black"),b="fadeToColor"==a.subtype?"out":"in";if("out"==b){var g=d.opacity;d.opacity=e.opacity;e.opacity=g}this.opacity=e.opacity;break;
case "barWipe":a.subtype=a.subtype||"leftToRight";f=this.htmlPlayerBkg;g=1==("reverse"==a.direction?1:0)+("out"==b?1:0);switch(a.subtype){case "leftToRight":d.width="0px";e.width=$(this.htmlPlayer).css("width");g&&(d.left=parseInt($(this.htmlPlayer).css("left").split("px")[0])+parseInt($(this.htmlPlayer).css("width").split("px")[0])+"px",e.left=$(this.htmlPlayer).css("left"));break;case "topToBottom":d.height="0px",e.height=$(this.htmlPlayer).css("height"),g&&(d.top=parseInt($(this.htmlPlayer).css("top").split("px")[0])+
parseInt($(this.htmlPlayer).css("height").split("px")[0])+"px",e.top=$(this.htmlPlayer).css("top"))}if("out"==b)for(i in d)g=d[i],d[i]=e[i],e[i]=g;break;case "irisWipe":a.subtype=a.subtype||"rectangle";f=this.htmlPlayerBkg;if("rectangle"==a.subtype){var g=parseInt($(this.htmlPlayer).css("left").split("px")[0]),o=parseInt($(this.htmlPlayer).css("top").split("px")[0]),h=parseInt($(this.htmlPlayer).css("width").split("px")[0]),m=parseInt($(this.htmlPlayer).css("height").split("px")[0]);d.width="0px";
d.height="0px";d.left=g+h/2+"px";d.top=o+m/2+"px";e.width=h+"px";e.height=m+"px";e.left=g+"px";e.top=o+"px";if("out"==b)for(i in d)g=d[i],d[i]=e[i],e[i]=g}else Debugger.warning(Debugger.WARN_NOT_IMPLEMENTED_YET,"transition",[a.type,a.subtype]);break;case "snakeWipe":case "clockWipe":Debugger.warning(Debugger.WARN_NOT_IMPLEMENTED_YET,"transition",[a.type])}$(f).css(d);$(f).animate(e,c);$(f).dequeue()};
MediaPlayer.prototype.show=function(){if(this.isVisible){this.transIn&&this.transIn._type&&(this.transIn=[this.transIn]);this.transOut&&this.transOut._type&&(this.transOut=[this.transOut]);for(i in this.transIn)this.applyTransition(this.transIn[i],"in");$(this.htmlPlayerBkg).css("display","inline");$(this.htmlPlayer).css("opacity",this.opacity)}};MediaPlayer.prototype.hide=function(){for(i in this.transOut)this.applyTransition(this.transOut[i],"out");$(this.htmlPlayerBkg).css("display","none")};
MediaPlayer.prototype.start=function(a){this.isStopped&&(this.presentation.focusManager.enableKeys(this.htmlPlayer),this.presentation.focusManager.addMedia(this.node.descriptor.focusIndex,this.htmlPlayer),this.isPlaying=!0,this.isStopped=!1,this.show(),this.checkType(["video","audio","image","text"])&&(this.checkType(["video","audio"])&&this.parentContext.syncPlayer(this),this.popcornPlayer.play(),a&&"area"==this.area[a]._type?this.area[this.area[a].id].begin&&(this.area[this.area[a].id].started=
!0,this.seek(this.area[this.area[a].id].beginTime),$(this.htmlPlayer).one("seeked",$.proxy(function(){this.parentContext.notify(this);this.popcornPlayer.play()},this))):this.parentContext.notify(this)),$(this.htmlPlayer).trigger("presentation.onBegin",[a]))};
MediaPlayer.prototype.stop=function(a){this.isStopped||(this.presentation.focusManager.disableKeys(this.htmlPlayer),this.presentation.focusManager.removeMedia(this.node.descriptor.focusIndex,this.htmlPlayer),this.isPlaying=!1,this.isStopped=!0,this.hide(),this.checkType(["video","audio","image","text"])&&this.popcornPlayer.pause(0),$(this.htmlPlayer).trigger("presentation.onEnd",[a]))};
MediaPlayer.prototype.pause=function(a){this.isPlaying&&(this.isStopped=this.isPlaying=!1,this.checkType(["video","audio","image","text"])&&this.popcornPlayer.pause(),$(this.htmlPlayer).trigger("presentation.onPause",[a]))};MediaPlayer.prototype.resume=function(a){!this.isStopped&&!this.isPlaying&&(this.isPlaying=!0,this.isStopped=!1,this.checkType(["video","audio","image","text"])&&this.popcornPlayer.play(),$(this.htmlPlayer).trigger("presentation.onResume",[a]))};
MediaPlayer.prototype.abort=function(a){this.isStopped||(this.presentation.focusManager.removeMedia(this.node.descriptor.focusIndex,this.htmlPlayer),this.isPlaying=!1,this.isStopped=!0,this.hide(),this.checkType(["video","audio","image","text"])&&this.popcornPlayer.pause(0),$(this.htmlPlayer).trigger("presentation.onAbort",[a]))};
MediaPlayer.prototype.seek=function(a){if(this.checkType(["video","audio","image","text"]))try{this.popcornPlayer.currentTime(a)}catch(b){eval("$(this.htmlPlayer).one('loadedmetadata',$.proxy(function() {this.popcornPlayer.currentTime("+a+");},this));")}};
MediaPlayer.prototype.seekAndPlay=function(a){if(!this.isStopped)if(this.checkType(["video","audio"])){try{this.popcornPlayer.currentTime(a)}catch(b){eval("$(this.htmlPlayer).one('loadedmetadata',$.proxy(function() {this.popcornPlayer.currentTime("+a+");},this));")}$(this.htmlPlayer).one("seeked",$.proxy(function(){this.popcornPlayer.play()},this))}else this.checkType(["image","text"])&&this.popcornPlayer.currentTime(a)};function Player(){this.create=function(){};this.start=function(){};this.stop=function(){};this.pause=function(){};this.resume=function(){};this.abort=function(){};this.seekAndPlay=function(){};this.selection=function(){}}
Player.prototype.bindEvents=function(){$(this.htmlPlayer).on("start",$.proxy(function(a,b,c,d){this.start(b);c&&c(d)},this));$(this.htmlPlayer).on("stop",$.proxy(function(a,b,c,d){this.stop(b);c&&c(d)},this));$(this.htmlPlayer).on("pause",$.proxy(function(a,b,c,d){this.pause(b);c&&c(d)},this));$(this.htmlPlayer).on("resume",$.proxy(function(a,b,c,d){this.resume(b);c&&c(d)},this));$(this.htmlPlayer).on("abort",$.proxy(function(a,b,c,d){this.abort(b);c&&c(d)},this));$(this.htmlPlayer).on("set",$.proxy(function(a,
b,c,d,e){this.setProperty(b,e);c&&c(d)},this));$(this.htmlPlayer).on("focus",$.proxy(function(){this.focus()},this));$(this.htmlPlayer).on("blur",$.proxy(function(){this.blur()},this));$(this.htmlPlayer).on("selection.onSelection",$.proxy(function(){this.selection()},this))};
Player.prototype.setProperty=function(a,b){var c=$(this.htmlPlayer).data("property");c[a]=b?b:"";$(this.htmlPlayer).data("property",c);$(this.htmlPlayer).trigger("attribution.onBeginAttribution",[a]);if(null!=b)switch(a){case "top":case "left":case "bottom":case "right":$(this.htmlPlayerBkg).css(a,b);break;case "height":case "width":c=b.split("%");if(1<c.length)var d=$(this.htmlPlayerBkg).css(a),b=parseInt(parseInt(d)*parseFloat(c[0])/100);$(this.htmlPlayer).css(a,b);$(this.htmlPlayerBkg).css(a,b);
break;case "location":b.split(",");this.setProperty("left",d[0]);this.setProperty("top",d[1]);break;case "size":b.split(",");this.setProperty("width",d[0]);this.setProperty("height",d[1]);break;case "bounds":d=b.split(",");this.setProperty("left",d[0]);this.setProperty("top",d[1]);this.setProperty("width",d[2]);this.setProperty("height",d[3]);break;case "zIndex":$(this.htmlPlayer).css("z-index",b);$(this.htmlPlayerBkg).css("z-index",b);break;case "soundLevel":this.checkType(["video","audio"])&&(c=
b.split("%"),1<c.length&&(b=c[0]/100),this.popcornPlayer.volume(b));break;case "balanceLevel":case "bassLevel":case "trebleLevel":b.split("%");Debugger.warning(Debugger.WARN_NOT_IMPLEMENTED_YET,"setProperty",[a]);break;case "background":$(this.htmlPlayerBkg).css("background-color",b);break;case "transparency":c=b.split("%");b=1<c.length?parseInt(c[0])/100:parseFloat(c[0]);this.opacity=1-b;$(this.htmlPlayer).css("opacity",this.opacity);break;case "visible":(this.isVisible="true"==b?!0:!1)?(this.presentation.focusManager.addMedia(this.node.descriptor.focusIndex,
this.htmlPlayer),$(this.htmlPlayerBkg).css("display","inline")):(this.presentation.focusManager.removeMedia(this.node.descriptor.focusIndex,this.htmlPlayer),$(this.htmlPlayerBkg).css("display","none"));break;case "scroll":Debugger.warning(Debugger.WARN_NOT_IMPLEMENTED_YET,"setProperty",[a]);break;case "fit":Debugger.warning(Debugger.WARN_NOT_IMPLEMENTED_YET,"setProperty",[a]);break;case "style":Debugger.warning(Debugger.WARN_NOT_IMPLEMENTED_YET,"setProperty",[a]);break;case "fontColor":$(this.htmlPlayer).css("color",
b);break;case "fontFamily":$(this.htmlPlayer).css("font-family",b);break;case "fontStyle":$(this.htmlPlayer).css("font-style",b);break;case "fontSize":$(this.htmlPlayer).css("font-size",b);break;case "fontVariant":$(this.htmlPlayer).css("font-variant",b);break;case "fontWeight":$(this.htmlPlayer).css("font-weight",b);break;case "explicitDur":c=b.split("s");this.explicitDur=parseInt(c[0]);break;case "baseDeviceRegion":case "deviceClass":case "plan":case "player":case "playerLife":case "reusePlayer":Debugger.warning(Debugger.WARN_NOT_IMPLEMENTED_YET,
"property",[a]);break;case "transInBorderColor":case "transInBorderWidth":case "transInDirection":case "transInDur":case "transInEndProgress":case "transInFadeColor":case "transInHorRepeat":case "transInStartProgress":case "transInSubtype":case "transInType":case "transInVertRepeat":case "transBorderColor":case "transOutBorderWidth":case "transOutDirection":case "transOutDur":case "transOutEndProgress":case "transOutFadeColor":case "transOutHorRepeat":case "transOutType":case "transOutStartProgress":case "transOutSubtype":case "transOutVertRepeat":Debugger.warning(Debugger.WARN_NOT_IMPLEMENTED_YET,
"property",[a]);break;case "service.currentFocus":case "default.focusBorderColor":case "default.selBorderColor":case "default.focusBorderWidth":case "default.focusBorderTransparency":this.checkType(["application"])&&this.presentation.systemSettings.setPropertyValue(a,b)}};Parser.prototype.parseArea=function(a,b,c){values=["(n\ufffdmero inteiro)s"];patt=/^\d+s$/;null!=a.begin&&!patt.test(a.begin)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["begin",a.begin,values]);null!=a.end&&!patt.test(a.end)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["end",a.end,values]);"application/x-ginga-time"==c.type&&(null==a.begin&&null==a.end)&&Debugger.error(Debugger.ERR_MISSING_ATTR,b,["begin","end"]);values=["(n\ufffdmero inteiro)"];patt=/^\d+$/;null!=a.first&&!patt.test(a.first)&&
Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["first",a.first,values]);null!=a.last&&!patt.test(a.last)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["last",a.last,values])};Parser.prototype.parseAssessmentStatement=function(a,b){values="eq ne gt lt gte lte".split(" ");null!=a.comparator&&-1==jQuery.inArray(a.comparator,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["comparator",a.comparator,values])};Parser.prototype.parseAttributeAssessment=function(a,b,c,d){null!=a.role&&(c=d.split("causalConnector#")[1].split(">")[0],this.uniqueTable["id#"+c]||(this.uniqueTable["id#"+c]=[]),this.uniqueTable["id#"+c][a.role]?this.uniqueTable["id#"+c][a.role].duplicated||(this.uniqueTable["id#"+c][a.role].duplicated=!0,Debugger.error(Debugger.ERR_DUPLICATED_ATTR,"role",[a.role,c,["simpleAction","simpleCondition","attributeAssessment"]])):this.uniqueTable["id#"+c][a.role]={duplicated:!1});values=["selection",
"presentation","attribution"];null!=a.eventType&&-1==jQuery.inArray(a.eventType,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["eventType",a.eventType,values]);values="VARIAVEL 0-9 A-Z * # MENU INFO GUIDE CURSOR_DOWN CURSOR_LEFT CURSOR_RIGHT CURSOR_UP CHANNEL_DOWN CHANNEL_UP VOLUME_DOWN VOLUME_UP ENTER RED GREEN YELLOW BLUE BACK EXIT POWER REWIND STOP EJECT PLAY RECORD PAUSE".split(" ");patt=/^([0-9A-Z]|\*|\$[A-Za-z_][0-9A-Za-z_]*|#|MENU|INFO|GUIDE|CURSOR_DOWN|CURSOR_LEFT|CURSOR_RIGHT|CURSOR_UP|CHANNEL_DOWN|CHANNEL_UP|VOLUME_DOWN|VOLUME_UP|ENTER|RED|GREEN|YELLOW|BLUE|BACK|EXIT|POWER|REWIND|STOP|EJECT|PLAY|RECORD|PAUSE)$/;
null==a.key?"selection"==a.eventType&&Debugger.error(Debugger.ERR_MISSING_ATTR,b,["key"]):patt.test(a.key)||Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["key",a.key,values]);switch(a.eventType){case "selection":values=["occurences","state"];break;case "presentation":values=["occurences","state","repetitions"];break;case "attribution":values=["occurences","state","repetitions","nodeProperty"]}null!=a.attributeType&&-1==jQuery.inArray(a.attributeType,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,
b,["attributeType",a.attributeType,values])};Parser.prototype.parseBind=function(){};Parser.prototype.parseBindParam=function(){};Parser.prototype.parseBindRule=function(){};Parser.prototype.parseBody=function(){};Parser.prototype.parseCausalConnector=function(){};Parser.prototype.parseCompositeRule=function(a,b){values=["and","or"];null!=a.operator&&-1==jQuery.inArray(a.operator,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["operator",a.operator,values])};Parser.prototype.parseCompoundAction=function(a,b){values=["par","seq"];null!=a.operator&&-1==jQuery.inArray(a.operator,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["operator",a.operator,values])};Parser.prototype.parseCompoundCondition=function(a,b){values=["and","or"];null!=a.operator&&-1==jQuery.inArray(a.operator,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["operator",a.operator,values]);values=["(n\ufffdmero inteiro positivo)s"];patt=/^\d+s$/;null!=a.delay&&!patt.test(a.delay)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["delay",a.delay,values])};Parser.prototype.parseCompoundStatement=function(a,b){values=["or","and"];null!=a.operator&&-1==jQuery.inArray(a.operator,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["operator",a.operator,values]);values=["true","false"];null!=a.isNegated&&-1==jQuery.inArray(a.isNegated,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["isNegated",a.isNegated,values])};Parser.prototype.parseConnectorBase=function(){};Parser.prototype.parseConnectorParam=function(){};Parser.prototype.parseContext=function(){};Parser.prototype.parseDefaultComponent=function(){};Parser.prototype.parseDefaultDescriptor=function(){};Parser.prototype.parseDescriptorBase=function(){};Parser.prototype.parseDescriptor=function(a,b){values=["(n\ufffdmero inteiro)s"];patt=/^\d+s$/;null!=a.explicitDur&&!patt.test(a.explicitDur)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["explicitDur",a.explicitDur,values]);values=["true","false"];null!=a.freeze&&-1==jQuery.inArray(a.freeze,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["freeze",a.freeze,values]);attrs=["focusBorderColor","selBorderColor"];values="white black silver gray red maroon fuchsia purple lime green yellow olive blue navy aqua teal".split(" ");
for(var c in attrs)attr=attrs[c],value=a[attr],null!=value&&-1==jQuery.inArray(value,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,[attr,value,values]);values=["(n\ufffdmero inteiro)"];patt=/^-?\d+$/;null!=a.focusBorderWidth&&!patt.test(a.focusBorderWidth)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["focusBorderWidth",a.focusBorderWidth,values]);values=["(n\ufffdmero real entre 0 e 1)","(n\ufffdmero real entre 0 e 100)%"];patt=/^((0?\.\d+|1(\.0+)?)|(\d?\d?\.\d+|100(\.0+)?)%)$/;
null!=a.focusBorderTransparency&&!patt.test(a.focusBorderTransparency)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["focusBorderTransparency",a.focusBorderTransparency,values])};Parser.prototype.parseDescriptorParam=function(a,b){values="background balanceLevel baseDeviceRegion bassLevel bottom bounds deviceClass fit fontColor fontFamily fontStyle fontSize fontVariant fontWeight height left location plan player playerLife reusePlayer right scroll size soundLevel style top transInBorderColor transInBorderWidth transInDirection transInDur transInEndProgress transInFadeColor transInHorRepeat transInStartProgress transInSubtype transInType transInVertRepeat transBorderColor transOutBorderWidth transOutDirection transOutDur transOutEndProgress transOutFadeColor transOutHorRepeat transOutType transOutStartProgress transOutSubtype transOutVertRepeat transparency trebleLevel visible width zIndex".split(" ");
null!=a.name&&-1==jQuery.inArray(a.name,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["name",a.name,values])};Parser.prototype.parseDescriptorSwitch=function(){};Parser.prototype.parseHead=function(){};Parser.prototype.parseImportBase=function(a){this.uniqueTable.alias||(this.uniqueTable.alias=[]);this.uniqueTable.alias[a.alias]?this.uniqueTable.alias[a.alias].duplicated||(this.uniqueTable.alias[a.alias].duplicated=!0,Debugger.error(Debugger.ERR_DUPLICATED_ALIAS,"importBase",[a.alias])):this.uniqueTable.alias[a.alias]={duplicated:!1}};Parser.prototype.parseImportedDocumentBase=function(){};Parser.prototype.parseImportNCL=function(a){this.uniqueTable.alias||(this.uniqueTable.alias=[]);this.uniqueTable.alias[a.alias]?this.uniqueTable.alias[a.alias].duplicated||(this.uniqueTable.alias[a.alias].duplicated=!0,Debugger.error(Debugger.ERR_DUPLICATED_ALIAS,"importNCL",[a.alias])):this.uniqueTable.alias[a.alias]={duplicated:!1}};Parser.prototype.parseLink=function(){};Parser.prototype.parseLinkParam=function(){};Parser.prototype.parseMapping=function(){};Parser.prototype.parseMedia=function(a,b){values=["new","instSame","gradSame"];null!=a.instance&&-1==jQuery.inArray(a.instance,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["instance",a.instance,values]);values="text/html text/plain text/css text/xml image/bmp image/png image/mng image/gif image/jpeg audio/basic audio/mp3 audio/mp2 audio/mpeg audio/mpeg4 video/mpeg application/x-ginga-NCLua application/x-ginga-NCLet application/x-ginga-settings application/x-ginga-time applications/x-ginga-NCL application/x-ncl-NCL application/x-ncl-NCLua application/x-ncl-NCLet application/x-ncl-settings application/x-ncl-time".split(" ");
if(null!=a.type)if(-1==jQuery.inArray(a.type,values))Debugger.error(ERR_INVALID_ATTR_VALUE,b,["type",a.type,values]);else if(null!=a.src){var c=a.src.split(".")[1];switch(a.type){case "text/html":"htm"!=c&&"html"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"text/html",["htm","html"]]);break;case "text/plain":"txt"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"text/plain",["txt"]]);break;case "text/css":"css"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"text/css",
["css"]]);break;case "text/xml":"xml"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"text/xml",["xml"]]);break;case "image/bmp":"bmp"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"image/bmp",["bmp"]]);break;case "image/png":"png"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"image/png",["png"]]);break;case "image/gif":"gif"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"image/gif",["gif"]]);break;case "image/jpeg":"jpg"!=c&&"jpeg"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,
b,[c,"image/jpeg",["jpg","jpeg"]]);break;case "audio/basic":"wav"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"audio/basic",["wav"]]);break;case "audio/mp3":"mp3"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"audio/mp3",["mp3"]]);break;case "audio/mp2":"mp2"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"audio/mp2",["mp2"]]);break;case "audio/mpeg":"mpeg"!=c&&"mpg"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"audio/mpeg",["mpeg","mpg"]]);break;
case "audio/mpeg4":"mp4"!=c&&"mpg4"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"audio/mpeg4",["mp4","mpg4"]]);break;case "video/mpeg":"mpeg"!=c&&"mpg"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"video/mpeg",["mpeg","mpg"]]);break;case "application/x-ginga-NCLua":"lua"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,b,[c,"application/x-ginga-NCLua",["lua"]]);break;case "application/x-ginga-NCLet":"class"!=c&&"jar"!=c&&Debugger.error(Debugger.ERR_INCOMPATIBLE_FILE_EXT,
b,[c,"application/x-ginga-NCLet",["class","jar"]])}}};Parser.prototype.parseMetadata=function(){};Parser.prototype.parseMeta=function(){};Parser.prototype.parseNCL=function(a,b){values=["http://www.ncl.org.br/NCL3.0/EDTVProfile","http://www.ncl.org.br/NCL3.0/BDTVProfile","http://www.ncl.org.br/NCL3.0/CausalConnectorProfile"];null!=a.xmlns&&-1==jQuery.inArray(a.xmlns,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["xmlns",a.xmlns,values])};Parser.prototype.parsePort=function(){};Parser.prototype.parseProperty=function(a){values="system.language system.caption system.subtitle system.returnBitRate(i) system.screenSize system.screenGraphicSize system.audioType system.screenSize(i) system.screenGraphicSize(i) system.audioType(i) system.devNumber(i) system.classType(i) system.info(i) system.classNumber system.CPU system.memory system.operatingSystem system.javaConfiguration system.javaProfile system.luaVersion user.age user.location user.genre default.focusBorderColor default.selBorderColor default.focusBorderWidth default.focusBorderTransparency service.currentFocus service.currentKeyMaster si.numberOfServices si.numberOfPartialServices si.channelNumber channel.keyCapture channel.virtualKeyBoard channel.keyboardBounds".split(" ");
null!=a.name&&-1==jQuery.inArray(a.name,values)&&(patt=/^system\.(returnBitRate|screenSize|screenGraphicSize|audioType|devNumber|classType|info)\(\d+\)$/,patt.test(a.name))};Parser.prototype.parseRegionBase=function(a,b){values=["systemScreen(i)","systemAudio(i)"];patt=/^systemScreen\(\d+\)$|^systemAudio\(\d+\)$/;null!=a.device&&!patt.test(a.device)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["device",a.device,values])};Parser.prototype.parseRegion=function(a,b,c){attrs="left right top bottom height width".split(" ");values=["(n\ufffdmero inteiro)","(n\ufffdmero inteiro)px","(n\ufffdmero real)%"];for(var d in attrs)attr=attrs[d],value=a[attr],null!=value&&(patt=/^(\d+|\d*\.\d+)px$|^(\d+|\d*\.\d+)%$|^(\d+|\d*\.\d+)$/,patt.test(value)||Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,[attr,value,values]));a.left&&(a.right&&a.width)&&(isFinite(a.left)&&isFinite(a.right)&&isFinite(a.width)&&isFinite(c.width))&&(d=parseInt(a.left)+
parseInt(a.right)+parseInt(a.width),d!=c.width&&Debugger.warning(Debugger.WARN_INVALID_REGION_DIMENSIONS,"region",[["left","right","width"],d,c.width]));a.top&&(a.bottom&&a.height)&&(isFinite(a.top)&&isFinite(a.bottom)&&isFinite(a.height)&&isFinite(c.height))&&(d=parseInt(a.top)+parseInt(a.bottom)+parseInt(a.height),d!=c.height&&Debugger.warning(Debugger.WARN_INVALID_REGION_DIMENSIONS,"region",[["top","bottom","height"],d,c.height]));values=["n\ufffdmero inteiro entre 0 e 255"];patt=/^\d+$/;null!=
a.zIndex&&(!patt.test(a.zIndex)||0>a.zIndex||255<a.zIndex)?Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["zIndex",a.zIndex,values]):(this.uniqueTable.zIndex||(this.uniqueTable.zIndex=[]),this.uniqueTable.zIndex[a.zIndex]?this.uniqueTable.zIndex[a.zIndex].duplicated||(this.uniqueTable.zIndex[a.zIndex].duplicated=!0,Debugger.warning(Debugger.WARN_DUPLICATED_ZINDEX,"region",[a.zIndex])):this.uniqueTable.zIndex[a.zIndex]={id:a.id,duplicated:!1})};Parser.prototype.parseRuleBase=function(){};Parser.prototype.parseRule=function(a,b){values="eq ne gt lt gte lte".split(" ");null!=a.comparator&&-1==jQuery.inArray(a.comparator,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["comparator",a.comparator,values])};Parser.prototype.parseSimpleAction=function(a,b,c,d){values="start stop abort pause resume set".split(" ");null!=a.role&&-1==jQuery.inArray(a.role,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["role",a.role,values]);null!=a.role&&(-1==jQuery.inArray(a.role,values)?Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["role",a.role,values]):(c=d.split("causalConnector#")[1].split(">")[0],this.uniqueTable["id#"+c]||(this.uniqueTable["id#"+c]=[]),this.uniqueTable["id#"+c][a.role]?this.uniqueTable["id#"+
c][a.role].duplicated||(this.uniqueTable["id#"+c][a.role].duplicated=!0,Debugger.error(Debugger.ERR_DUPLICATED_ATTR,"role",[a.role,c,["simpleAction","simpleCondition","attributeAssessment"]])):this.uniqueTable["id#"+c][a.role]={duplicated:!1}));values=["start","stop","abort","pause","resume"];null!=a.actionType&&-1==jQuery.inArray(a.actionType,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["actionType",a.actionType,values]);values=["presentation","selection","attribution"];null!=a.eventType&&
-1==jQuery.inArray(a.eventType,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["eventType",a.eventType,values]);null==a.value&&("attribution"==a.eventType||"set"==a.role)&&Debugger.error(Debugger.ERR_MISSING_ATTR,b,["value"]);values=["(n\ufffdmero inteiro entre 1 e max)"];patt=/^\d+$/;null!=a.min&&(patt.test(a.min)?(1>parseInt(a.min)||null!=a.max&&"unbounded"!=a.max&&parseInt(a.max)<parseInt(a.min))&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["min",a.min,values]):Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,
b,["min",a.min,values]));values=["(n\ufffdmero inteiro maior ou igual a min)","unbounded"];patt=/^(\d+|unbounded)$/;null!=a.max&&(patt.test(a.max)?"unbounded"!=a.max&&(1>parseInt(a.max)||null!=a.min&&parseInt(a.max)<parseInt(a.min))&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["max",a.max,values]):Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["max",a.max,values]));values=["par","seq"];null==a.qualifier?null!=a.min&&1<parseInt(a.min)?Debugger.error(Debugger.ERR_MISSING_ATTR,b,["qualifier"]):
null!=a.max&&("unbounded"==a.max||1<parseInt(a.max))&&Debugger.error(Debugger.ERR_MISSING_ATTR,b,["qualifier"]):-1==jQuery.inArray(a.qualifier,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["qualifier",a.qualifier,values]);values=["(n\ufffdmero inteiro positivo)"];patt=/^\d+$/;null!=a.repeat&&!patt.test(a.repeat)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["repeat",a.repeat,values]);values=["(n\ufffdmero inteiro positivo)s"];patt=/^\d+s$/;null!=a.duration&&!patt.test(a.duration)&&
Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["duration",a.duration,values])};Parser.prototype.parseSimpleCondition=function(a,b,c,d){values="onBegin onEnd onAbort onPause onResume onSelection onBeginAttribution onEndAttribution".split(" ");null!=a.role&&-1==jQuery.inArray(a.role,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["role",a.role,values]);null!=a.role&&(-1==jQuery.inArray(a.role,values)?Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["role",a.role,values]):(c=d.split("causalConnector#")[1].split(">")[0],this.uniqueTable["id#"+c]||(this.uniqueTable["id#"+
c]=[]),this.uniqueTable["id#"+c][a.role]?this.uniqueTable["id#"+c][a.role].duplicated||(this.uniqueTable["id#"+c][a.role].duplicated=!0,Debugger.error(Debugger.ERR_DUPLICATED_ATTR,"role",[a.role,c,["simpleAction","simpleCondition","attributeAssessment"]])):this.uniqueTable["id#"+c][a.role]={duplicated:!1}));values=["starts","stops","pauses","resumes","aborts"];null!=a.transition&&-1==jQuery.inArray(a.transition,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["transition",a.transition,values]);
values=["presentation","selection","attribution"];null!=a.eventType&&-1==jQuery.inArray(a.eventType,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["eventType",a.eventType,values]);values="VARIAVEL 0-9 A-Z * # MENU INFO GUIDE CURSOR_DOWN CURSOR_LEFT CURSOR_RIGHT CURSOR_UP CHANNEL_DOWN CHANNEL_UP VOLUME_DOWN VOLUME_UP ENTER RED GREEN YELLOW BLUE BACK EXIT POWER REWIND STOP EJECT PLAY RECORD PAUSE".split(" ");patt=/^([0-9A-Z]|\*|\$[A-Za-z_][0-9A-Za-z_]*|#|MENU|INFO|GUIDE|CURSOR_DOWN|CURSOR_LEFT|CURSOR_RIGHT|CURSOR_UP|CHANNEL_DOWN|CHANNEL_UP|VOLUME_DOWN|VOLUME_UP|ENTER|RED|GREEN|YELLOW|BLUE|BACK|EXIT|POWER|REWIND|STOP|EJECT|PLAY|RECORD|PAUSE)$/;
null!=a.key&&!patt.test(a.key)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["key",a.key,values]);values=["(n\ufffdmero inteiro entre 1 e max)"];patt=/^\d+$/;null!=a.min&&(patt.test(a.min)?(1>parseInt(a.min)||null!=a.max&&"unbounded"!=a.max&&parseInt(a.max)<parseInt(a.min))&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["min",a.min,values]):Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["min",a.min,values]));values=["(n\ufffdmero inteiro maior ou igual a min)","unbounded"];patt=/^(\d+|unbounded)$/;
null!=a.max&&(patt.test(a.max)?"unbounded"!=a.max&&(1>parseInt(a.max)||null!=a.min&&parseInt(a.max)<parseInt(a.min))&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["max",a.max,values]):Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["max",a.max,values]));values=["and","or"];null==a.qualifier?null!=a.min&&1<parseInt(a.min)?Debugger.error(Debugger.ERR_MISSING_ATTR,b,["qualifier"]):null!=a.max&&("unbounded"==a.max||1<parseInt(a.max))&&Debugger.error(Debugger.ERR_MISSING_ATTR,b,["qualifier"]):-1==
jQuery.inArray(a.qualifier,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["qualifier",a.qualifier,values])};Parser.prototype.parseSwitch=function(){};Parser.prototype.parseSwitchPort=function(){};Parser.prototype.parseTransitionBase=function(){};Parser.prototype.parseTransition=function(a,b){values=["barWipe","irisWipe","clockWipe","snakeWipe","fade"];null!=a.type&&-1==jQuery.inArray(a.type,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["type",a.type,values]);values=["(n\ufffdmero inteiro positivo)s"];patt=/^\d+s$/;null!=a.dur&&!patt.test(a.dur)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["dur",a.dur,values]);values=["(n\ufffdmero real entre 0 e 1)"];patt=/^(0*\.\d+|1\.0)$/;null!=a.startProgress&&!patt.test(a.startProgress)&&
Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["startProgress",a.startProgress,values]);null!=a.endProgress&&!patt.test(a.endProgress)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["endProgress",a.endProgress,values]);values=["forward","reverse"];null!=a.direction&&-1==jQuery.inArray(a.direction,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["direction",a.direction,values]);values="white black silver gray red maroon fuchsia purple lime green yellow olive blue navy aqua teal".split(" ");
null!=a.fadeColor&&-1==jQuery.inArray(a.fadeColor,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["fadeColor",a.fadeColor,values]);values=["(n\ufffdmero inteiro n\ufffdo negativo)"];patt=/^\d+$/;null!=a.horRepeat&&-1==patt.test(a.horRepeat,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["horRepeat",a.horRepeat,values]);values=["(n\ufffdmero inteiro n\ufffdo negativo)"];patt=/^\d+$/;null!=a.vertRepeat&&-1==patt.test(a.vertRepeat,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,
b,["vertRepeat",a.vertRepeat,values]);values=["(n\ufffdmero inteiro n\ufffdo negativo)"];patt=/^\d+$/;null!=a.borderWidth&&-1==patt.test(a.borderWidth,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["borderWidth",a.borderWidth,values]);values="white black silver gray red maroon fuchsia purple lime green yellow olive blue navy aqua teal blend".split(" ");null!=a.borderColor&&-1==jQuery.inArray(a.borderColor,values)&&Debugger.error(Debugger.ERR_INVALID_ATTR_VALUE,b,["borderColor",a.borderColor,
values])};Parser.prototype.parseValueAssessment=function(){};
